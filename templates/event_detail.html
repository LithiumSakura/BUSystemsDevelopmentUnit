{% extends "base.html" %}
{% block content %}
<h2>{{ event.title }}</h2>

<p><b>When:</b> {{ event.start_time.strftime("%d %b %Y %H:%M") }} â†’ {{ event.end_time.strftime("%d %b %Y %H:%M") }}</p>
<p><b>Where:</b> {{ event.location or "TBC" }}</p>
<p>{{ event.description or "" }}</p>

{% if role == "admin" %}
  <p>
    <a href="{{ url_for('admin_event_edit', event_id=event.id) }}">Edit</a>
  </p>
  <form method="post" action="{{ url_for('admin_event_delete', event_id=event.id) }}" onsubmit="return confirm('Delete this event?');">
    <button type="submit">Delete</button>
  </form>
{% endif %}

<hr>

{% if user_email %}
    <form method="post" action="{{ url_for('toggle_rsvp', event_id=event.id) }}">
        <label>
            <input
                type="checkbox"
                name="going"
                {% if existing_rsvp and existing_rsvp.status == "going" %}
                    checked
                {% endif %}
            >
            I'm going
        </label>

        <br><br>
        <button type="submit">Update RSVP</button>
    </form>

    {% if existing_rsvp %}
        {% if existing_rsvp.status == "going" %}
            <p><b>Status:</b> Going</p>
        {% else %}
            <p><b>Status:</b> RSVP cancelled</p>
        {% endif %}
    {% endif %}
    {% else %}
    <p><a href="{{ url_for('login') }}">Log in</a> to RSVP.</p>
{% endif %}

{% endblock %}